use int.Int
use int.ComputerDivision
use coma.Std

let product (a b: int) {b >= 0} (return (c: int) {c = a * b}) =
  loop
  [ loop {q >= 0} {p * q + r = a * b}
    = if {q > 0} next (-> return {r})
      [ next ->
          if {mod q 2 = 1} (-> [&r <- r + p] step) step
          [ step -> [&p <- p + p | &q <- div q 2] loop ]
      ]
  ]
  [ &p: int = a | &q: int = b | &r: int = 0 ]
