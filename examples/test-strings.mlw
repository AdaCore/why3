
module Harness

  use string.String
  use int.Int

  goal Empty: "" = ""

  goal Empty2: empty = ""

  goal Test1:
    let s = "abcdef" in substring s 2 3 = "cde"

  goal TestConcat1:
    let s1 = "abc" in
    let s2 = "defg" in
    concat s1 s2 = "abcdefg"

  goal TestConcat2:
    let s1 = "abc" in
    let s2 = "defg" in
    let s3 = "hij" in
    concat (concat s1 s2) s3 = "abcdefghij"

  goal TestConcat3:
    let s1 = "abc" in
    let s2 = "defg" in
    let s3 = "hij" in
    let s4 = "klmnop" in
    concat (concat s1 s2) (concat s3 s4) = "abcdefghijklmnop"

  goal TestConcat4:
    let s1 = "abc" in
    let s2 = "defg" in
    let s3 = "hij" in
    let s4 = "klmnop" in
    let s5 = "qrst" in
    concat (concat s1 s2) (concat (concat s3 s4) s5) = "abcdefghijklmnopqrst"

  goal TestConcat5:
    concat "" "" = ""

  lemma concat_assoc: forall s1 s2 s3.
    concat (concat s1 s2) s3 = concat s1 (concat s2 s3)

  lemma concat_empty: forall s.
    concat s empty = concat empty s = s

  goal TestLength1: length "a" = 1
  goal TestLength2: length "ab" = 2
  goal TestLength3: length "abc" = 3
  goal TestLength4: length (concat "ab" "12") = 4

  lemma length_empty: length "" = 0

  lemma length_concat: forall s1 s2.
    length (concat s1 s2) = length s1 + length s2

  goal TestLt1: lt "" "a"
  goal TestLt2: lt "a" "b"
  goal TestLt3: lt "ab" "b"
  goal TestLt4: lt "abcde" "b"
  goal TestLt5: lt "a" "1"
  goal TestLt6: lt "A" "a"

  lemma lt_empty: forall s.
    s <> empty -> lt empty s

  lemma lt_transitive: forall s1 s2 s3. (* CHECK - not proved *)
    lt s1 s2 && lt s2 s3 -> lt s1 s3

  lemma lt_not_com: forall s1 s2.
    lt s1 s2 -> not (lt s2 s1)

  lemma le: forall s1.
    le s1 s1

  lemma lt_le: forall s1 s2.
    lt s1 s2 -> le s1 s2

  lemma lt_le_eq: forall s1 s2.
    le s1 s2 -> lt s1 s2 || s1 = s2

  lemma le_transitive: forall s1 s2 s3. (* CHECK - not proved *)
    le s1 s2 && le s2 s3 -> le s1 s3

  lemma at_out_of_range: forall s i.
    i >= length s || i < 0 -> s[i] = empty

  lemma at_empty: forall i.
    empty[i] = empty

  goal TestSubstring1: forall i x.
    substring "" i x = ""

  goal TestSubstring2: forall s i x.
    i < 0 -> substring s i x = ""

  goal TestSubstring3: forall s i x.
    i > length s -> substring s i x = ""

  goal TestSubstring4:
    substring "abcdef" 1 3 = "bcd"

  goal TestSubstring5:
    substring "abcdef" 1 10 = "bcdef"

  lemma substring_of_length_zero: forall s i.
    substring s i 0 = ""

  lemma substring_out_of_range: forall s i x.
    i < 0 || i >= length s -> substring s i x = empty

  lemma substring_smaller: forall s i x.
    length (substring s i x) <= length s

  lemma substring_negative: forall i x s.
    i < 0 || x < 0 -> substring s i x = ""

  lemma substring_negative2: forall i x s.
    i < 0 || x < 0 -> length (substring s i x) = 0

  lemma substring_smaller_x: forall s i x.
    x > 0 && i + x > length s -> length (substring s i x) <= x

  lemma prefix_substring: forall s1 s2.
    prefixof s1 s2 <-> s1 = substring s2 0 (length s1)

  lemma prefix_concat: forall s1 s2.
    prefixof s1 (concat s1 s2)

  lemma suffix_substring: forall s1 s2.
    suffixof s1 s2 <-> s1 = substring s2 (length s2 - length s1) (length s1)

  lemma suffix_concat: forall s1 s2.
    suffixof s2 (concat s1 s2)

  lemma contains_substring: forall s1 s2. (* CHECK can we write this w/o exists? *)
    contains s1 s2 <-> exists i. i > 0 && substring s2 i (length s1) = s1

  lemma contains_concat: forall s1 s2 s3.
    contains s1 (concat s1 s2) && contains s2 (concat s1 s2) &&
      contains s1 (concat (concat s1 s2) s3) && contains s2 (concat (concat s1 s2) s3) &&
        contains s3 (concat (concat s1 s2) s3)

  goal TestIndefof1:
    indexof "" "" 0 = 0

  goal TestIndefof2:
    indexof "a" "" 0 = 0

  goal TestIndefof3:
    indexof "" "a" 0 = -1

  goal TestIndefof4:
    indexof "a" "" 1 = 1

  goal TestIndefof5:
    indexof "a" "" 2 = -1

  goal TestIndefof6:
    indexof "ab" "" 2 = 2

  goal TestIndefof7:
    indexof "abcdef" "c" 0 = 2

  goal TestIndefof8:
    indexof "abcdef" "c" 2 = 2

  goal TestIndefof9:
    indexof "abcdef" "c" 3 = -1

  goal TestIndefof10:
    indexof "abcdef" "cdef" 0 = 2

  goal TestIndexof11: forall s1.
    indexof s1 "" 0 = 0

  lemma indexof_empty1: forall s.
    s <> "" -> indexof "" s 0 = -1

  lemma indexof_empty2: forall s i.
    0 <= i <= length s -> indexof s "" i = i

  lemma indexof_contains: forall s1 s2.
    let j = indexof s1 s2 0 in
    contains s1 s2 && s2 <> empty ->
      0 <= j <= length s1 && substring s1 j (length s2) = s2

  lemma contains_indexof: forall s1 s2 i.
    0 <= indexof s1 s2 i -> contains s1 s2

  lemma not_contains_indexof: forall s1 s2 i.
    not (contains s1 s2)  -> indexof s1 s2 i = -1

  lemma substring_indexof: forall s t i.
    let j = indexof s t i in
    j >= 0 && 0 <= i <= length s ->
      substring s j (length t) = t

  lemma indexof_out_of_range: forall i s t.
    not (0 <= i <= length s) -> indexof s t i = -1

  lemma indexof_in_range: forall i s t.
    0 <= i <= length s ->
      indexof s t i = -1 || i <= indexof s t i <= length s

  goal TestReplace1: forall s2 s3.
   s2 <> "" -> replace "" s2 s3 = ""

  goal TestReplace2: forall s1 s3. (* check standard to see if this makes sense *)
   replace s1 "" s3 = concat s3 s1

  goal TestReplace3:
   replace "abcde" "bc" "1234" = "a1234de"

  goal TestReplace4:
   replace "abcdefg" "fg" "" = "abcde"

  goal TestReplace5:
   replace "abcdefabcdef" "bc" "123" = "a123defabcdef"

  lemma not_contains_replace: forall s1 s2 s3.
    not(contains s1 s2) -> replace s1 s2 s3 = s1

  lemma replace_empty1: forall s1 s2.
    replace s1 s2 "" = s1

  lemma replace_empty2: forall s1 s3.
    replace s1 "" s3 = concat s1 s3

  lemma replace_substring_indexof: forall s t1 t2.
    let i = indexof s t1 0 in
    replace s t1 t2 =
      if i < 0 then s else
        concat (concat (substring s 0 i)
                       t2)
                (substring s (i + length t1) (length s - i - length t1))

  lemma not_contains_replaceall: forall s1 s2 s3.
    not(contains s1 s2) -> replaceall s1 s2 s3 = s1

  lemma replaceall_empty1: forall s1 s2.
    replaceall s1 s2 "" = s1

  lemma replaceall_empty2: forall s1 s3. (* TODO Whaattt??? *)
    replaceall s1 "" s3 = "abc"

end
