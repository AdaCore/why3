
MAIN=main
OBJ=euler001__Euler001

ML  = $(addsuffix .ml, $(OBJ))
CMO = $(addsuffix .cmo, $(OBJ))
CMX = $(addsuffix .cmx, $(OBJ))

OCAMLOPT=ocamlopt -noassert -inline 1000

INCLUDE=@BIGINTINCLUDE@ -I ../../lib/why3

all: $(MAIN).@OCAMLBEST@

extract: $(ML)

$(MAIN).byte: $(CMO)  $(MAIN).cmo
	ocamlc $(INCLUDE) @BIGINTLIB@.cma why3extract.cma -o $@ $^

$(MAIN).opt: $(CMX)  $(MAIN).cmx
	$(OCAMLOPT) $(INCLUDE) @BIGINTLIB@.cmxa why3extract.cmxa -o $@ $^

$(MAIN).cmx: $(CMX)

$(ML): ../euler001.mlw
	../../bin/why3 -E ocaml ../euler001.mlw -o .

%.cmx: %.ml
	$(OCAMLOPT) $(INCLUDE) -annot -c $<

%.cmo: %.ml
	ocamlc $(INCLUDE) -annot -c $<

%.cmi: %.mli
	ocamlc $(INCLUDE) -annot -c $<

clean::
	rm -f $(ML) *.cm[xio] *.o *.annot $(MAIN).opt $(MAIN).byte
	rm -f why3__*.ml* euler001__*.ml* int__*.ml*

Makefile: Makefile.in ../../config.status
	cd ../.. ; ./config.status chmod --file examples/euler001/Makefile

