#!/bin/sh

# auto bench for why

export WHYLIB=../lib

pgm=$1
option=$2

goods () {
    for f in $1/*.why; do
	echo -n "  "$f"... "
	base=$1/`basename $f .why`
	# running Why
	if ! $pgm $2 $f > /dev/null 2>&1; then
	    echo "why FAILED"
	    $pgm $2 $f
	    exit 1
	fi
	echo "why ok... "
    done
}

bads () {
    for f in $1/*.why; do
	echo -n "  "$f"... "
	if $pgm $2 $f > /dev/null 2>&1; then 
	    echo "$pgm $2 $f"
	    echo "FAILED!"
	    exit 1 
        else 
	    echo "ok"
	fi
    done
}

drivers () {
    for f in $1/*.drv; do
	echo -n "  "$f"... "
	base=$1/`basename $f .why`
	# running Why
	if ! $pgm $2 $f > /dev/null 2>&1; then
	    echo "why FAILED"
	    $pgm $2 $f
	    exit 1
	fi
	echo "why ok... "
    done
}

# 1. Syntax
echo "=== Parsing good files  ==="
goods bench/typing/bad --parse-only
echo ""

# 2. Typing
echo "=== Type-checking bad files ==="
bads bench/typing/bad --type-only
echo ""

echo "=== Type-checking good files ==="
goods bench/typing/good --type-only
echo ""

echo "=== Type-checking lib/prelude ==="
goods lib/prelude --type-only
echo ""

echo "=== Checking lib/drivers ==="
drivers lib/drivers --driver
echo ""

